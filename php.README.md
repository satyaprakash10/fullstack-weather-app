# Gitpad

# Install local environment

## Install non docker

- Install php8 and extension

```
sudo apt-get install php8.0
sudo apt-get install libapache2-mod-php8.0 php8.0-fpm libapache2-mod-fcgid php8.0-curl php8.0-dev php8.0-gd php8.0-mbstring php8.0-zip php8.0-mysql php8.0-xml
sudo apt-get install php-pgsql
```

- Config nginx

```
server {
    listen 80;
    server_name egg.test;

    # SSL configuration
    #
    # listen 443 ssl default_server;
    # listen [::]:443 ssl default_server;
    #
    # Note: You should disable gzip for SSL traffic.
    # See: https://bugs.debian.org/773332
    #
    # Read up on ssl_ciphers to ensure a secure configuration.
    # See: https://bugs.debian.org/765782
    #
    # Self signed certs generated by the ssl-cert package
    # Don't use them in a production server!
    #
    # include snippets/snakeoil.conf;

    root /home/local/SUN-ASTERISK/phan.ngoc/Documents/projects/crm-server/public;

    # Add index.php to the list if you are using PHP
    index index.php index.html index.htm index.nginx-debian.html;

    location / {
        # First attempt to serve request as file, then
        # as directory, then fall back to displaying a 404.
        try_files $uri $uri/ /index.php?$query_string;
    }

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass unix:/run/php/php8.0-fpm.sock;

        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    location ~ /\.ht {
      deny all;
    }

    location /socket.io {
        proxy_pass http://localhost:6001; #could be localhost if Echo and NginX are on the same box
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
    }
}
```

```
sudo nginx -s reload
```

- Install docker postgres 12.4

```
docker run --name postgres-12-4 --publish 5432:5432 -e POSTGRES_PASSWORD=mysecretpassword -v $PWD/.docker/postgres/data:/var/lib/postgresql/data -d postgres:12.4
```

### DB connection, laravel .env file

```
DB_CONNECTION=postgres
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=postgres
DB_USERNAME=postgres
DB_PASSWORD=mysecretpassword
```

## Install with docker

```
docker-compose up -d
```
### DB connection, laravel .env file

```
DB_CONNECTION=postgres
DB_HOST=postgres
DB_PORT=5432
DB_DATABASE=postgres
DB_USERNAME=postgres
DB_PASSWORD=mysecretpassword
```

# Setup environment

## Migrate and seed DB
```
php artisan config:clear
php artisan migrate
php artisan db:seed
```

## Seeding authentication:

```
php artisan passport:install
```

## Account login:

```
Username: giftpad001
Password: Aa@123456
```


### Link API login:
http://egg.test/api/v1/auth/admin/login


## Deploy for server DEV (SUN)

### Deploy by rebuild docker (when change setting nginx, php-fpm, ...)

```
dep deploy development
```

### Fast deploy only by pull code

```
dep build:fast development
```

### Build for FE

```
yarn && yarn build

HOST=localhost yarn dev
```

## Cheatsheet

### Refresh seed data from begining
```
php artisan migrate:fresh --seed
```
